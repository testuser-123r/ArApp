<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>AR Ball Spiel</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        video, canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        #overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 20px;
            z-index: 1;
        }
    </style>
</head>
<body>
    <div id="overlay">
        <p id="score">Punkte: 0</p>
        <p id="misses">Verfehlt: 0</p>
    </div>
    <video id="video" width="640" height="480" autoplay playsinline style="display: none;"></video>
    <canvas id="canvas" width="640" height="480"></canvas>

    <!-- Einbindung von TensorFlow.js und dem Handpose-Modell -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.19.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose@0.0.7/dist/handpose.min.js"></script>

    <script>
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let model;
        let ball = { x: Math.random() * canvas.width, y: 0, radius: 20 };
        let score = 0;
        let misses = 0;
        let gameOver = false;

        async function init() {
            // Webcam starten
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
            } catch (error) {
                console.error('Fehler beim Zugriff auf die Kamera:', error);
                alert('Kamera konnte nicht gestartet werden. Bitte 체berpr체fen Sie die Berechtigungen.');
                return;
            }

            // Handpose-Modell laden
            try {
                model = await handpose.load();
            } catch (error) {
                console.error('Fehler beim Laden des Handpose-Modells:', error);
                alert('Handpose-Modell konnte nicht geladen werden.');
                return;
            }

            // Spiel starten
            video.addEventListener('loadeddata', loop);
        }

        async function loop() {
            if (gameOver) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Video spiegeln
            ctx.save();
            ctx.scale(-1, 1);
            ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
            ctx.restore();

            // Handerkennung
            const predictions = await model.estimateHands(video, true);
            if (predictions.length > 0) {
                const landmarks = predictions[0].landmarks;

                // Handfl채che zeichnen
                ctx.beginPath();
                ctx.arc(canvas.width - landmarks[0][0], landmarks[0][1], 10, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
                ctx.fill();

                // Kollisionspr체fung
                let dx = (canvas.width - landmarks[0][0]) - ball.x;
                let dy = landmarks[0][1] - ball.y;
                let distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < ball.radius + 10) {
                    score++;
                    document.getElementById('score').innerText = 'Punkte: ' + score;
                    ball.x = Math.random() * canvas.width;
                    ball.y = 0;
                }
            }

            // Ball bewegen
            ball.y += 5;
            if (ball.y > canvas.height) {
                ball.x = Math.random() * canvas.width;
                ball.y = 0;
                misses++;
                document.getElementById('misses').innerText = 'Verfehlt: ' + misses;
                if (misses >= 3) {
                    gameOver = true;
                    ctx.fillStyle = 'red';
                    ctx.font = '40px Arial';
                    ctx.fillText('Spiel vorbei!', canvas.width / 2 - 100, canvas.height / 2);
                    return;
                }
            }

            // Ball zeichnen
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, 2 * Math.PI);
            ctx.fillStyle = 'blue';
            ctx.fill();

            requestAnimationFrame(loop);
        }

        init();
    </script>
</body>
</html>


