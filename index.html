<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>AR Ball Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- A-Frame Library -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.js für AR-Unterstützung -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #score {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: white;
            z-index: 1;
            font-family: Arial, sans-serif;
        }
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            color: red;
            display: none;
            z-index: 1;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="score">Punkte: 0</div>
    <div id="gameOver">Spiel Vorbei!</div>

    <a-scene embedded arjs>
        <!-- Marker Definition -->
        <a-marker preset="hiro">
            <!-- Bereich, in dem die Bälle spawnen -->
            <a-entity id="spawnArea" position="0 0 0"></a-entity>
        </a-marker>

        <!-- Kamera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Initialisierung der Variablen
        let score = 0;
        const scoreElement = document.getElementById('score');
        const gameOverElement = document.getElementById('gameOver');
        const scene = document.querySelector('a-scene');
        const spawnArea = document.getElementById('spawnArea');
        const balls = [];
        let gameOver = false;

        // Einstellungen
        const spawnInterval = 2000; // in Millisekunden
        const ballFallSpeed = 0.02; // Geschwindigkeit, mit der die Bälle fallen
        const spawnRange = 0.5; // Bereich, in dem die Bälle gespawnt werden

        // Funktion zum Spawnen von Bällen
        function spawnBall() {
            if (gameOver) return;

            const ball = document.createElement('a-sphere');
            // Position relativ zum Marker
            ball.setAttribute('position', {
                x: (Math.random() - 0.5) * 2 * spawnRange,
                y: 0.5, // Start über dem Marker
                z: (Math.random() - 0.5) * 2 * spawnRange
            });
            ball.setAttribute('radius', 0.05);
            ball.setAttribute('color', '#FF0000');
            ball.setAttribute('class', 'ball');

            // Event Listener für das Treffen des Balls
            ball.addEventListener('click', () => {
                if (gameOver) return;
                scene.removeChild(ball);
                const index = balls.indexOf(ball);
                if (index > -1) {
                    balls.splice(index, 1);
                }
                score += 1;
                scoreElement.innerText = `Punkte: ${score}`;
            });

            spawnArea.appendChild(ball);
            balls.push(ball);
        }

        // Intervall zum regelmäßigen Spawnen von Bällen
        const ballSpawner = setInterval(spawnBall, spawnInterval);

        // Funktion zum Aktualisieren der Position der Bälle
        function updateBalls() {
            if (gameOver) return;

            for (let i = balls.length - 1; i >= 0; i--) {
                const ball = balls[i];
                const pos = ball.getAttribute('position');
                pos.y -= ballFallSpeed;
                ball.setAttribute('position', pos);

                // Überprüfen, ob der Ball den Boden erreicht hat
                if (pos.y < -0.5) { // Anpassung auf den Marker-Niederschlagspunkt
                    endGame();
                    break;
                }
            }
            requestAnimationFrame(updateBalls);
        }

        // Funktion zum Beenden des Spiels
        function endGame() {
            gameOver = true;
            clearInterval(ballSpawner);
            gameOverElement.style.display = 'block';
            // Entfernen aller verbleibenden Bälle
            balls.forEach(ball => spawnArea.removeChild(ball));
            balls.length = 0;
        }

        // Start der Ball-Update-Schleife, sobald die Szene geladen ist
        scene.addEventListener('loaded', () => {
            updateBalls();
        });
    </script>
</body>
</html>
